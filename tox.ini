[tox]
envlist = py38,docs,manifest,black
skipsdist = True
usedevelop = True
indexserver =
    spotify = https://pypi.spotify.net/simple/

[testenv]
basepython = python3.8
setenv =
    PYTHONHASHSEED = 0
    VIRTUALENV_PIP=21.0.1

download = true
commands =
    py37: mypy gcbd_sentinel tests
    py37: /usr/bin/find . -name "*.pyc" -delete
    py37: coverage erase
    py37: py.test --junitxml=test-results/junit.xml {posargs}
    py37: flake8 gcbd_sentinel tests

install_command = pip install {opts} {packages}


[testenv:black]
; "black" is a code formatter, much like gofmt. It requires 3.6 or higher.
; Tingle has 3.6 available to it; but feel free to uncomment the line
; `ignore_outcome` if it fails. Docs: https://github.com/ambv/black
;ignore_outcome = true
deps = black
skip_install = true
commands =
    ; remove the '--diff' and '--check' flags to automatically write out corrections
    black gcbd_sentinel tests --diff --check

; The sections defined below are for configuring specific tools that are used
; in the above testenvs. Usually, if the tool is ran directly/outside of tox,
; i.e. `(env) $ pytest`, it will still pick up this configuration.

[flake8]
ignore = E203, E266, E501, W503, F403, F401, E731
max-line-length = 120
max-complexity = 18
select = B,C,E,F,W,T4,B9

[pytest]
addopts = -v
;--cov=gcbd_sentinel --cov-report=xml:cobertura/coverage.xml --cov-report=term-missing
testpaths = tests
